/**
 * jQuery highlightTextarea 1.0
 *
 * Copyright 2012, Damien "Mistic" Sorel
 *    http://www.strangeplanet.fr
 *
 * thanks to Julien L for part of the code
 *    http://stackoverflow.com/a/7599199
 *
 * Dual licensed under the MIT or GPL Version 3 licenses.
 *    http://www.opensource.org/licenses/mit-license.php
 *    http://www.gnu.org/licenses/gpl.html
 *
 * Depends:
 *	  jquery.js
 *    jquery-ui.js | resizable (optional)
 */
 
(function(a){a.fn.highlightTextarea=function(b){var c={words:["a","e","i","o","u"],color:"#ffff00",caseSensitive:true,resizable:false,id:null,debug:false};b=a.extend(c,b);b.regParam="g";if(b.caseSensitive==false)b.regParam+="i";this.each(function(){function n(a){if(typeof a!="string"){a=a.toString()}a=a.replace(/&/g,"&amp;");a=a.replace(/"/g,"&quot;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/'/g,"&#146;");return a}function m(a){if(a!=a.replace("em","")){var b=parseFloat(a.replace("em","")),c=jQuery('<div style="display: none; font-size: 1em; margin: 0; padding:0; height: auto; line-height: 1; border:0;"> </div>').appendTo("body"),d=c.height();c.remove();return Math.round(b*d)}else if(a!=a.replace("px","")){return parseInt(a.replace("px",""))}else{return parseInt(a)}}function l(a,b,c){for(var d=0;d<c.length;d++){b.css(c[d],a.css(c[d]))}}function k(a){if(a){d.css({width:c.outerWidth(true),height:c.outerHeight(true)});e.css({width:c.width(),height:c.height()});f.css({height:c.height()})}if(c[0].clientHeight<c[0].scrollHeight&&c.css("overflow")!="hidden"&&c.css("overflow-y")!="hidden"||c.css("overflow")=="scroll"||c.css("overflow-y")=="scroll"){f.css({width:c.width()-26,"padding-right":"26px"})}else{f.css({width:c.width()-9,"padding-right":"9px"})}f.css({top:-c.scrollTop()+"px",height:f.height()+c.scrollTop()})}function j(a,c,d){return a.replace(new RegExp("("+c+")",b.regParam),d)}function i(a){a=n(a);a=j(a,"\n","<br/>");a=j(a,"  ","  ");if(b.words[0]!=""){replace=n(b.words[0]);for(var c=1;c<b.words.length;c++)replace+="|"+n(b.words[c]);a=j(a,replace,'<span class="highlight" style="background-color:'+b.color+';">$1</span>')}f.html(a);k()}var c=a(this);c.wrap('<div class="highlightTextarea" />');var d=c.parent(".highlightTextarea");d.prepend('<div class="highlighterContainer"><div class="highlighter"></div></div>');var e=d.children(".highlighterContainer");var f=e.children(".highlighter");if(b.id!=null){d.attr("id",b.id)}var g=m(c.css("margin-top"))+m(c.css("border-top-width")),h=m(c.css("margin-left"))+m(c.css("border-left-width"));l(c,d,["float","vertical-align"]);d.css({width:c.outerWidth(true),height:c.outerHeight(true)});l(c,e,["background","background-image","background-color","background-position","background-repeat","background-origin","background-clip","background-size","padding-top","padding-right","padding-bottom","padding-left"]);e.css({top:g+"px",left:h+"px",width:c.width(),height:c.height()});l(c,f,["font-size","font-family","font-style","font-weight","line-height"]);f.css({width:c.width(),height:c.height()});c.css({background:"none"});if(b.debug){f.css({color:"#f00"})}f.bind("click",function(){c.focus()});c.bind({keyup:function(){i(c.val())},scroll:function(){k()},resize:function(){k(true)}});if(b.resizable){if(jQuery.ui){c.resizable({handles:"se",resize:function(){k(true)}});a(".highlightTextarea .ui-resizable-se").css({bottom:"13px",right:"1px"})}}i(c.val())});return this}})(jQuery)